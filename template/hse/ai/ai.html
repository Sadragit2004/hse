<!-- templates/hse/ai/ai.html -->
{% extends 'base.html' %}

{% block title %}Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ HSE{% endblock %}

{% block page_actions %}
<button type="button" class="btn btn-outline-secondary" id="clearChatBtn">
    <i class="fas fa-trash-alt me-2"></i>Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú¯ÙØªÚ¯Ùˆ
</button>
<button type="button" class="btn btn-outline-primary" id="newChatBtn">
    <i class="fas fa-plus me-2"></i>Ú¯ÙØªÚ¯ÙˆÛŒ Ø¬Ø¯ÛŒØ¯
</button>
{% endblock %}

{% block content %}
<div class="chat-container">
    <div class="row">
        <!-- Ù¾Ù†Ù„ Ø³Ù…Øª Ú†Ù¾ Ø¨Ø±Ø§ÛŒ Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§ Ùˆ Ø±Ø§Ù‡Ù†Ù…Ø§ -->
        <div class="col-lg-3 d-none d-lg-block">
            <div class="card sticky-top" style="top: 20px;">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6 class="text-primary">ğŸ’¡ Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ:</h6>
                        <div class="list-group list-group-flush">
                            <button type="button" class="list-group-item list-group-item-action example-question" data-question="Ú†Ú¯ÙˆÙ†Ù‡ ÛŒÚ© Ø¨Ø§Ø²Ø±Ø³ÛŒ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†Ù…ØŸ">
                                <small>Ú†Ú¯ÙˆÙ†Ù‡ ÛŒÚ© Ø¨Ø§Ø²Ø±Ø³ÛŒ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†Ù…ØŸ</small>
                            </button>
                            <button type="button" class="list-group-item list-group-item-action example-question" data-question="Ú¯Ø²Ø§Ø±Ø´ Ø­ÙˆØ§Ø¯Ø« Ø§ÛŒÙ† Ù‡ÙØªÙ‡ Ø±Ø§ Ù†Ø´Ø§Ù† Ø¨Ø¯Ù‡">
                                <small>Ú¯Ø²Ø§Ø±Ø´ Ø­ÙˆØ§Ø¯Ø« Ø§ÛŒÙ† Ù‡ÙØªÙ‡ Ø±Ø§ Ù†Ø´Ø§Ù† Ø¨Ø¯Ù‡</small>
                            </button>
                            <button type="button" class="list-group-item list-group-item-action example-question" data-question="Ø¢Ù…ÙˆØ²Ø´â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù… Ú©Ø¯Ø§Ù…â€ŒØ§Ù†Ø¯ØŸ">
                                <small>Ø¢Ù…ÙˆØ²Ø´â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù… Ú©Ø¯Ø§Ù…â€ŒØ§Ù†Ø¯ØŸ</small>
                            </button>
                            <button type="button" class="list-group-item list-group-item-action example-question" data-question="ÙˆØ¸Ø§ÛŒÙ Ù…Ø¹ÙˆÙ‚Ù‡ Ø§Ù…Ø±ÙˆØ² Ø±Ø§ Ù„ÛŒØ³Øª Ú©Ù†">
                                <small>ÙˆØ¸Ø§ÛŒÙ Ù…Ø¹ÙˆÙ‚Ù‡ Ø§Ù…Ø±ÙˆØ² Ø±Ø§ Ù„ÛŒØ³Øª Ú©Ù†</small>
                            </button>
                        </div>
                    </div>

                    <div class="mb-3">
                        <h6 class="text-primary">ğŸ”§ Ø¯Ø³ØªÙˆØ±Ø§Øª Ø³Ø±ÛŒØ¹:</h6>
                        <div class="d-flex flex-wrap gap-1">
                            <span class="badge bg-info cursor-pointer quick-action" data-action="inspections">Ø¨Ø§Ø²Ø±Ø³ÛŒâ€ŒÙ‡Ø§</span>
                            <span class="badge bg-warning cursor-pointer quick-action" data-action="incidents">Ø­ÙˆØ§Ø¯Ø«</span>
                            <span class="badge bg-success cursor-pointer quick-action" data-action="trainings">Ø¢Ù…ÙˆØ²Ø´â€ŒÙ‡Ø§</span>
                            <span class="badge bg-danger cursor-pointer quick-action" data-action="tasks">ÙˆØ¸Ø§ÛŒÙ</span>
                            <span class="badge bg-primary cursor-pointer quick-action" data-action="reports">Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</span>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h6 class="text-primary">ğŸ“Š Ø¯Ø³ØªÛŒØ§Ø± Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯:</h6>
                        <ul class="list-unstyled small">
                            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Ø§ÛŒØ¬Ø§Ø¯ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯</li>
                            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</li>
                            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</li>
                            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i>Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø³ÙˆØ§Ù„Ø§Øª HSE</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù‚Ø³Ù…Øª Ø§ØµÙ„ÛŒ Ú†Øª -->
        <div class="col-lg-9">
            <div class="card">
                <div class="card-header bg-gradient-primary text-white">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h5 class="mb-0">
                                <i class="fas fa-robot me-2"></i>Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ HSE
                                <small class="d-block mt-1 fs-6 opacity-75">Ù‡Ø± Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø± Ø²Ù…ÛŒÙ†Ù‡ Ø§ÛŒÙ…Ù†ÛŒØŒ Ø¨Ù‡Ø¯Ø§Ø´Øª Ùˆ Ù…Ø­ÛŒØ· Ø²ÛŒØ³Øª Ø¯Ø§Ø±ÛŒØ¯ Ø¨Ù¾Ø±Ø³ÛŒØ¯</small>
                            </h5>
                        </div>
                        <div class="d-flex align-items-center">
                            <span class="badge bg-light text-primary me-2" id="statusIndicator">
                                <i class="fas fa-circle text-success me-1"></i>Ø¢Ù†Ù„Ø§ÛŒÙ†
                            </span>
                            <div class="dropdown">
                                <button class="btn btn-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-cog"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" id="exportChatBtn"><i class="fas fa-download me-2"></i>Ø°Ø®ÛŒØ±Ù‡ Ú¯ÙØªÚ¯Ùˆ</a></li>
                                    <li><a class="dropdown-item" href="#" id="toggleSoundBtn"><i class="fas fa-volume-up me-2"></i>ØµØ¯Ø§</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" id="helpBtn"><i class="fas fa-question-circle me-2"></i>Ø±Ø§Ù‡Ù†Ù…Ø§</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ù†Ø§Ø­ÛŒÙ‡ Ú†Øª -->
                <div class="card-body chat-body p-0">
                    <div class="chat-messages" id="chatMessages">
                        <!-- Ù¾ÛŒØ§Ù… Ø®ÙˆØ´Ø§Ù…Ø¯Ú¯ÙˆÛŒÛŒ -->
                        <div class="chat-message ai-message">
                            <div class="message-avatar">
                                <div class="avatar ai-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <strong>Ø¯Ø³ØªÛŒØ§Ø± HSE</strong>
                                    <small class="text-muted ms-2">Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù†</small>
                                </div>
                                <div class="message-text">
                                    Ø³Ù„Ø§Ù…! ğŸ‘‹ Ù…Ù† Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ HSE Ø´Ù…Ø§ Ù‡Ø³ØªÙ….
                                    <br>
                                    Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ø¯Ø± Ø²Ù…ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ú©Ù…Ú©ØªÙˆÙ† Ú©Ù†Ù…:
                                    <br><br>
                                    â€¢ <strong>Ø¨Ø§Ø²Ø±Ø³ÛŒâ€ŒÙ‡Ø§ Ùˆ Ù…Ù…ÛŒØ²ÛŒâ€ŒÙ‡Ø§</strong>
                                    â€¢ <strong>Ø«Ø¨Øª Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø­ÙˆØ§Ø¯Ø«</strong>
                                    â€¢ <strong>Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø¢Ù…ÙˆØ²Ø´â€ŒÙ‡Ø§</strong>
                                    â€¢ <strong>Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙˆØ¸Ø§ÛŒÙ</strong>
                                    â€¢ <strong>ØªÙ‡ÛŒÙ‡ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ HSE</strong>
                                    <br><br>
                                    Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ø¨Ø±Ø§ØªÙˆÙ† Ø§Ù†Ø¬Ø§Ù… Ø¨Ø¯Ù…ØŸ
                                </div>
                                <div class="message-actions mt-2">
                                    <button type="button" class="btn btn-sm btn-outline-primary me-2 quick-question" data-question="Ø¢Ù…ÙˆØ²Ø´ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†">
                                        <i class="fas fa-graduation-cap me-1"></i>Ø¢Ù…ÙˆØ²Ø´ Ø¬Ø¯ÛŒØ¯
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-warning me-2 quick-question" data-question="Ø¨Ø§Ø²Ø±Ø³ÛŒ Ø§Ù…Ø±ÙˆØ² Ø±Ø§ Ù†Ø´Ø§Ù† Ø¨Ø¯Ù‡">
                                        <i class="fas fa-clipboard-check me-1"></i>Ø¨Ø§Ø²Ø±Ø³ÛŒ Ø§Ù…Ø±ÙˆØ²
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-danger quick-question" data-question="Ø¢Ù…Ø§Ø± Ø­ÙˆØ§Ø¯Ø« Ø§ÛŒÙ† Ù…Ø§Ù‡">
                                        <i class="fas fa-chart-line me-1"></i>Ø¢Ù…Ø§Ø± Ø­ÙˆØ§Ø¯Ø«
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ù†Ø§Ø­ÛŒÙ‡ ÙˆØ±ÙˆØ¯ Ù¾ÛŒØ§Ù… -->
                <div class="card-footer">
                    <form id="chatForm">
                        <div class="input-group">
                            <textarea class="form-control" id="messageInput"
                                      placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯... (Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Enter + Shift Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯)"
                                      rows="2" style="resize: none;"></textarea>
                            <button class="btn btn-primary" type="submit" id="sendBtn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mt-2">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="voiceInputToggle">
                                <label class="form-check-label small" for="voiceInputToggle">
                                    <i class="fas fa-microphone me-1"></i>ÙˆØ±ÙˆØ¯ ØµÙˆØªÛŒ
                                </label>
                            </div>
                            <div class="small text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                <span id="typingIndicator" class="d-none">
                                    <span class="typing-dots">
                                        <span>.</span><span>.</span><span>.</span>
                                    </span>
                                    Ø¯Ø³ØªÛŒØ§Ø± Ø¯Ø± Ø­Ø§Ù„ ØªØ§ÛŒÙ¾ Ø§Ø³Øª
                                </span>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Ù¾Ù†Ù„ Ù¾Ø§ÛŒÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø¶Ø§ÙÛŒ -->
            <div class="row mt-3">
                <div class="col-md-4">
                    <div class="card bg-light border">
                        <div class="card-body py-2">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-bolt text-warning fa-lg"></i>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <small class="text-muted d-block">ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…</small>
                                    <strong>Ù‡Ù…Ù‡ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ ÙØ¹Ø§Ù„</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-light border">
                        <div class="card-body py-2">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-database text-info fa-lg"></i>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <small class="text-muted d-block">Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²</small>
                                    <strong>Û³Û² Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-light border">
                        <div class="card-body py-2">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-clock text-success fa-lg"></i>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <small class="text-muted d-block">Ù¾Ø§Ø³Ø®â€ŒÚ¯ÙˆÛŒÛŒ</small>
                                    <strong>Ú©Ù…ØªØ± Ø§Ø² Ûµ Ø«Ø§Ù†ÛŒÙ‡</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.chat-container {
    height: calc(100vh - 180px);
}

.chat-body {
    height: 500px;
    overflow-y: auto;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}

.chat-messages {
    padding: 20px;
    min-height: 100%;
}

.chat-message {
    display: flex;
    margin-bottom: 20px;
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.user-message {
    flex-direction: row-reverse;
}

.ai-message {
    flex-direction: row;
}

.message-avatar {
    flex-shrink: 0;
    margin: 0 10px;
}

.avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
}

.user-avatar {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.ai-avatar {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
}

.message-content {
    max-width: 70%;
    padding: 12px 16px;
    border-radius: 18px;
    position: relative;
}

.user-message .message-content {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-bottom-right-radius: 4px;
}

.ai-message .message-content {
    background: white;
    color: #333;
    border-bottom-left-radius: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.message-header {
    display: flex;
    align-items: center;
    margin-bottom: 5px;
}

.user-message .message-header {
    justify-content: flex-end;
}

.message-text {
    line-height: 1.5;
}

.message-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
}

.typing-dots span {
    animation: typing 1.4s infinite;
    opacity: 0.6;
}

.typing-dots span:nth-child(1) { animation-delay: 0s; }
.typing-dots span:nth-child(2) { animation-delay: 0.2s; }
.typing-dots span:nth-child(3) { animation-delay: 0.4s; }

@keyframes typing {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 1; }
}

.cursor-pointer {
    cursor: pointer;
}

.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
}

.quick-action:hover {
    transform: translateY(-2px);
    transition: transform 0.2s;
}

.example-question:hover {
    background-color: #f8f9fa;
    border-left: 3px solid #667eea;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const chatMessages = document.getElementById('chatMessages');
    const messageInput = document.getElementById('messageInput');
    const chatForm = document.getElementById('chatForm');
    const sendBtn = document.getElementById('sendBtn');
    const typingIndicator = document.getElementById('typingIndicator');
    const clearChatBtn = document.getElementById('clearChatBtn');
    const newChatBtn = document.getElementById('newChatBtn');

    // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ† Ú†Øª
    function scrollToBottom() {
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø±
    function addUserMessage(text) {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'chat-message user-message';
        messageDiv.innerHTML = `
            <div class="message-avatar">
                <div class="avatar user-avatar">
                    <i class="fas fa-user"></i>
                </div>
            </div>
            <div class="message-content">
                <div class="message-header">
                    <strong>Ø´Ù…Ø§</strong>
                    <small class="text-muted ms-2">${new Date().toLocaleTimeString('fa-IR')}</small>
                </div>
                <div class="message-text">${text}</div>
            </div>
        `;
        chatMessages.appendChild(messageDiv);
        scrollToBottom();
    }

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ø¯Ø³ØªÛŒØ§Ø±
    function addAiMessage(text, actions = null) {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'chat-message ai-message';

        let actionsHtml = '';
        if (actions) {
            actionsHtml = `<div class="message-actions mt-2">${actions}</div>`;
        }

        messageDiv.innerHTML = `
            <div class="message-avatar">
                <div class="avatar ai-avatar">
                    <i class="fas fa-robot"></i>
                </div>
            </div>
            <div class="message-content">
                <div class="message-header">
                    <strong>Ø¯Ø³ØªÛŒØ§Ø± HSE</strong>
                    <small class="text-muted ms-2">${new Date().toLocaleTimeString('fa-IR')}</small>
                </div>
                <div class="message-text">${text}</div>
                ${actionsHtml}
            </div>
        `;
        chatMessages.appendChild(messageDiv);
        scrollToBottom();
    }

    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ§ÛŒÙ¾ Ø¯Ø³ØªÛŒØ§Ø±
    function simulateTyping(duration = 1000) {
        typingIndicator.classList.remove('d-none');
        return new Promise(resolve => {
            setTimeout(() => {
                typingIndicator.classList.add('d-none');
                resolve();
            }, duration);
        });
    }

    // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø³ÙˆØ§Ù„ Ùˆ ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø®
    async function processQuestion(question) {
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø±
        addUserMessage(question);

        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ§ÛŒÙ¾
        await simulateTyping(1500);

        // ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³ÙˆØ§Ù„
        let response = '';
        let actions = null;

        question = question.toLowerCase();

        if (question.includes('Ø³Ù„Ø§Ù…') || question.includes('hi') || question.includes('hello')) {
            response = `Ø³Ù„Ø§Ù…! ğŸ‘‹ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡Ù…ØŸ`;
            actions = `
                <button type="button" class="btn btn-sm btn-outline-primary me-2 quick-question" data-question="Ú†Ú¯ÙˆÙ†Ù‡ Ú¯Ø²Ø§Ø±Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†Ù…">
                    <i class="fas fa-file-alt me-1"></i>Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø²Ø§Ø±Ø´
                </button>
                <button type="button" class="btn btn-sm btn-outline-success me-2 quick-question" data-question="Ø¢Ù…Ø§Ø± Ø§Ù…Ø±ÙˆØ²">
                    <i class="fas fa-chart-bar me-1"></i>Ø¢Ù…Ø§Ø± Ø§Ù…Ø±ÙˆØ²
                </button>
            `;
        }
        else if (question.includes('Ø¨Ø§Ø²Ø±Ø³ÛŒ') || question.includes('inspection')) {
            if (question.includes('Ø¬Ø¯ÛŒØ¯') || question.includes('Ø§ÛŒØ¬Ø§Ø¯')) {
                response = `Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø§Ø²Ø±Ø³ÛŒ Ø¬Ø¯ÛŒØ¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ù…Ù†ÙˆÛŒ "Ø¨Ø§Ø²Ø±Ø³ÛŒâ€ŒÙ‡Ø§" â¡ï¸ "Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø§Ø²Ø±Ø³ÛŒ Ø¬Ø¯ÛŒØ¯" Ø§Ù‚Ø¯Ø§Ù… Ú©Ù†ÛŒØ¯.`;
                actions = `
                    <button type="button" class="btn btn-sm btn-primary me-2" onclick="window.location.href='#'">
                        <i class="fas fa-plus me-1"></i>Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø§Ø²Ø±Ø³ÛŒ
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="window.location.href='#'">
                        <i class="fas fa-list me-1"></i>Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„ÛŒØ³Øª
                    </button>
                `;
            } else {
                response = `ğŸ“‹ <strong>Ø¨Ø§Ø²Ø±Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²:</strong><br>
                â€¢ Û³ Ø¨Ø§Ø²Ø±Ø³ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø´Ø¯Ù‡<br>
                â€¢ Û² Ø¨Ø§Ø²Ø±Ø³ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…<br>
                â€¢ Û± Ø¨Ø§Ø²Ø±Ø³ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡<br><br>
                Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¨ÛŒØ´ØªØ±:`;
                actions = `
                    <button type="button" class="btn btn-sm btn-primary me-2" onclick="window.location.href='#'">
                        <i class="fas fa-eye me-1"></i>Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-primary quick-question" data-question="Ø¨Ø§Ø²Ø±Ø³ÛŒ Ù…Ø¹ÙˆÙ‚Ù‡">
                        <i class="fas fa-exclamation-triangle me-1"></i>Ø¨Ø§Ø²Ø±Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø¹ÙˆÙ‚Ù‡
                    </button>
                `;
            }
        }
        else if (question.includes('Ø­Ø§Ø¯Ø«Ù‡') || question.includes('incident')) {
            response = `âš ï¸ <strong>Ø¢Ù…Ø§Ø± Ø­ÙˆØ§Ø¯Ø« Ø§ÛŒÙ† Ù…Ø§Ù‡:</strong><br>
            â€¢ Ú©Ù„ Ø­ÙˆØ§Ø¯Ø«: Û±Û² Ù…ÙˆØ±Ø¯<br>
            â€¢ Ø­ÙˆØ§Ø¯Ø« Ø´Ø¯ÛŒØ¯: Û² Ù…ÙˆØ±Ø¯<br>
            â€¢ Ø´Ø¨Ù‡ Ø­ÙˆØ§Ø¯Ø«: Û¸ Ù…ÙˆØ±Ø¯<br>
            â€¢ Ø­ÙˆØ§Ø¯Ø« Ø¬Ø²Ø¦ÛŒ: Û² Ù…ÙˆØ±Ø¯<br><br>
            Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡Ù…ØŸ`;
            actions = `
                <button type="button" class="btn btn-sm btn-danger me-2" onclick="window.location.href='#'">
                    <i class="fas fa-plus me-1"></i>Ø«Ø¨Øª Ø­Ø§Ø¯Ø«Ù‡ Ø¬Ø¯ÛŒØ¯
                </button>
                <button type="button" class="btn btn-sm btn-outline-danger" onclick="window.location.href='#'">
                    <i class="fas fa-chart-line me-1"></i>Ú¯Ø²Ø§Ø±Ø´ Ø¢Ù…Ø§Ø±ÛŒ
                </button>
            `;
        }
        else if (question.includes('Ø¢Ù…ÙˆØ²Ø´') || question.includes('training')) {
            response = `ğŸ“ <strong>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¢Ù…ÙˆØ²Ø´â€ŒÙ‡Ø§:</strong><br>
            â€¢ Ûµ Ø¢Ù…ÙˆØ²Ø´ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø´Ø¯Ù‡<br>
            â€¢ Û³ Ø¢Ù…ÙˆØ²Ø´ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ<br>
            â€¢ Û¸ Ø¢Ù…ÙˆØ²Ø´ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡ Ø§ÛŒÙ† Ù…Ø§Ù‡<br><br>
            Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ù…ÙˆØ²Ø´â€ŒÙ‡Ø§:`;
            actions = `
                <button type="button" class="btn btn-sm btn-success me-2" onclick="window.location.href='#'">
                    <i class="fas fa-graduation-cap me-1"></i>Ø¢Ù…ÙˆØ²Ø´ Ø¬Ø¯ÛŒØ¯
                </button>
                <button type="button" class="btn btn-sm btn-outline-success" onclick="window.location.href='#'">
                    <i class="fas fa-list me-1"></i>Ù„ÛŒØ³Øª Ø¢Ù…ÙˆØ²Ø´â€ŒÙ‡Ø§
                </button>
            `;
        }
        else if (question.includes('ÙˆØ¸ÛŒÙÙ‡') || question.includes('task')) {
            response = `âœ… <strong>ÙˆØ¸Ø§ÛŒÙ Ø§Ù…Ø±ÙˆØ²:</strong><br>
            â€¢ Ûµ ÙˆØ¸ÛŒÙÙ‡ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±<br>
            â€¢ Û³ ÙˆØ¸ÛŒÙÙ‡ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…<br>
            â€¢ Û² ÙˆØ¸ÛŒÙÙ‡ Ù…Ø¹ÙˆÙ‚Ù‡<br><br>
            Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø³Ø±ÛŒØ¹:`;
            actions = `
                <button type="button" class="btn btn-sm btn-warning me-2" onclick="window.location.href='#'">
                    <i class="fas fa-tasks me-1"></i>ÙˆØ¸ÛŒÙÙ‡ Ø¬Ø¯ÛŒØ¯
                </button>
                <button type="button" class="btn btn-sm btn-outline-warning" onclick="window.location.href='#'">
                    <i class="fas fa-calendar me-1"></i>Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ
                </button>
            `;
        }
        else if (question.includes('Ú¯Ø²Ø§Ø±Ø´') || question.includes('report')) {
            response = `ğŸ“Š <strong>Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ HSE:</strong><br>
            â€¢ Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø§ÛŒÙ…Ù†ÛŒ<br>
            â€¢ Ú¯Ø²Ø§Ø±Ø´ ÙØµÙ„ÛŒ Ù…Ø­ÛŒØ· Ø²ÛŒØ³Øª<br>
            â€¢ Ú¯Ø²Ø§Ø±Ø´ Ø³Ø§Ù„Ø§Ù†Ù‡ Ø¨Ù‡Ø¯Ø§Ø´Øª<br>
            â€¢ Ú¯Ø²Ø§Ø±Ø´ Ø­ÙˆØ§Ø¯Ø« Ù‡ÙØªÚ¯ÛŒ<br><br>
            Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§:`;
            actions = `
                <button type="button" class="btn btn-sm btn-info me-2" onclick="window.location.href='#'">
                    <i class="fas fa-file-medical me-1"></i>Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø¯ÛŒØ¯
                </button>
                <button type="button" class="btn btn-sm btn-outline-info" onclick="window.location.href='#'">
                    <i class="fas fa-archive me-1"></i>Ø¢Ø±Ø´ÛŒÙˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§
                </button>
            `;
        }
        else {
            response = `Ø³ÙˆØ§Ù„ Ø´Ù…Ø§ Ø±Ø§ Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…. Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¯Ø± Ø²Ù…ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ú©Ù…Ú© Ú©Ù†Ù…:<br><br>
            â€¢ <strong>Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø§Ø²Ø±Ø³ÛŒâ€ŒÙ‡Ø§ Ùˆ Ù…Ù…ÛŒØ²ÛŒâ€ŒÙ‡Ø§</strong><br>
            â€¢ <strong>Ø«Ø¨Øª Ùˆ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø­ÙˆØ§Ø¯Ø«</strong><br>
            â€¢ <strong>Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ù…ÙˆØ²Ø´â€ŒÙ‡Ø§</strong><br>
            â€¢ <strong>Ø§ÛŒØ¬Ø§Ø¯ Ùˆ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙˆØ¸Ø§ÛŒÙ</strong><br>
            â€¢ <strong>ØªÙ‡ÛŒÙ‡ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ HSE</strong><br><br>
            Ù„Ø·ÙØ§Ù‹ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ù…Ø·Ø±Ø­ Ú©Ù†ÛŒØ¯.`;
            actions = `
                <button type="button" class="btn btn-sm btn-outline-primary me-2 quick-question" data-question="Ú†Ú¯ÙˆÙ†Ù‡ Ø­Ø§Ø¯Ø«Ù‡ Ø«Ø¨Øª Ú©Ù†Ù…">
                    <i class="fas fa-exclamation-triangle me-1"></i>Ø«Ø¨Øª Ø­Ø§Ø¯Ø«Ù‡
                </button>
                <button type="button" class="btn btn-sm btn-outline-success quick-question" data-question="Ø¢Ù…ÙˆØ²Ø´ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†">
                    <i class="fas fa-graduation-cap me-1"></i>Ø¢Ù…ÙˆØ²Ø´ Ø¬Ø¯ÛŒØ¯
                </button>
            `;
        }

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾Ø§Ø³Ø® Ø¯Ø³ØªÛŒØ§Ø±
        addAiMessage(response, actions);
    }

    // Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù…
    chatForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const message = messageInput.value.trim();

        if (message) {
            processQuestion(message);
            messageInput.value = '';
            messageInput.focus();
        }
    });

    // Ù…Ø¯ÛŒØ±ÛŒØª Enter + Shift Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„
    messageInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            chatForm.dispatchEvent(new Event('submit'));
        }
    });

    // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÙˆØ§Ù„ Ø³Ø±ÛŒØ¹
    document.querySelectorAll('.example-question, .quick-question').forEach(btn => {
        btn.addEventListener('click', function() {
            const question = this.dataset.question;
            messageInput.value = question;
            chatForm.dispatchEvent(new Event('submit'));
        });
    });

    // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù‚Ø¯Ø§Ù… Ø³Ø±ÛŒØ¹
    document.querySelectorAll('.quick-action').forEach(btn => {
        btn.addEventListener('click', function() {
            const action = this.dataset.action;
            let question = '';

            switch(action) {
                case 'inspections':
                    question = 'Ø¨Ø§Ø²Ø±Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² Ø±Ø§ Ù†Ø´Ø§Ù† Ø¨Ø¯Ù‡';
                    break;
                case 'incidents':
                    question = 'Ø¢Ø®Ø±ÛŒÙ† Ø­ÙˆØ§Ø¯Ø« Ø«Ø¨Øª Ø´Ø¯Ù‡';
                    break;
                case 'trainings':
                    question = 'Ø¢Ù…ÙˆØ²Ø´â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ';
                    break;
                case 'tasks':
                    question = 'ÙˆØ¸Ø§ÛŒÙ Ù…Ø¹ÙˆÙ‚Ù‡ Ø§Ù…Ø±ÙˆØ²';
                    break;
                case 'reports':
                    question = 'Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù‡Ø§Ù†Ù‡ HSE';
                    break;
            }

            messageInput.value = question;
            chatForm.dispatchEvent(new Event('submit'));
        });
    });

    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú†Øª
    clearChatBtn.addEventListener('click', function() {
        if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ú¯ÙØªÚ¯Ùˆ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
            chatMessages.innerHTML = '';
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ø®ÙˆØ´Ø§Ù…Ø¯Ú¯ÙˆÛŒÛŒ Ù…Ø¬Ø¯Ø¯
            addAiMessage(`Ú¯ÙØªÚ¯Ùˆ Ù¾Ø§Ú© Ø´Ø¯. Ø³Ù„Ø§Ù… Ù…Ø¬Ø¯Ø¯! ğŸ‘‹ Ù…Ù† Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ HSE Ø´Ù…Ø§ Ù‡Ø³ØªÙ…. Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡Ù…ØŸ`);
        }
    });

    // Ú¯ÙØªÚ¯ÙˆÛŒ Ø¬Ø¯ÛŒØ¯
    newChatBtn.addEventListener('click', function() {
        chatMessages.innerHTML = '';
        addAiMessage(`Ú¯ÙØªÚ¯ÙˆÛŒ Ø¬Ø¯ÛŒØ¯ Ø´Ø±ÙˆØ¹ Ø´Ø¯. Ø³Ù„Ø§Ù…! ğŸ‘‹ Ù…Ù† Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ HSE Ø´Ù…Ø§ Ù‡Ø³ØªÙ…. Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡Ù…ØŸ`);
    });

    // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ†
    scrollToBottom();

    // ÙÙˆÚ©ÙˆØ³ Ø±ÙˆÛŒ ÙÛŒÙ„Ø¯ ÙˆØ±ÙˆØ¯ÛŒ
    messageInput.focus();
});
</script>
{% endblock %}